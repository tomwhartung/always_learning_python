# 22-django_postgresql_exp

Repo for trying out using PostGres with a fresh django project.

## References

* https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-django-application-on-ubuntu-16-04
* https://tutorial.djangogirls.org/en/django_start_project/
* https://tutorial.djangogirls.org/en/django_admin/

## Installation

Starting out with nothing, after running the following steps.
These steps were originally performed for the 23-som_postgres_exp project, but we got stuck and decided to try doing this first.

### Step (0) Install Postgres in Ubuntu, and use it to create a user and a database.

See instructions in the following file in the jmws_accoutrements repo:

* doc/ubuntu/specific_hosts/2016-bette/5-updating_python_etc.txt

#### Summary of commands run (copied from 5-updating_python_etc.txt):

As root:

```
apt-get install libpq-dev postgresql postgresql-contrib
su - postgres
psql        # prompt changes
```

Use the postgres shell to create the user and database:

```
CREATE USER django1 WITH PASSWORD 'abc123';                ## CREATE ROLE
CREATE DATABASE django_fresh owner django1;                ## CREATE DATABASE
ALTER ROLE django1 SET client_encoding TO 'utf8';          ## ALTER ROLE
ALTER ROLE django1 SET default_transaction_isolation TO 'read committed';
ALTER ROLE django1 SET timezone TO 'UTC';                  ## ALTER ROLE
\q      ## log out
```

Also installed phpPgAdmin (see 5-updating_python_etc.txt for details).

### Step (1) Install python postgres "psycopg2" package globally:

As root:

```
pip3 install psycopg2
```

### Step (2) Create a fresh django project:

As tomh:

```
golpy
cd 22-django_postgresql_exp
mkdir Site
cd  Site
django-admin startproject myproject .
lf
git add --all .
git commit -m 'Initial version of django files generated by startproject.'
```

Following is a listing of the files created (output of lf command):

```
manage.py
myproject/__init__.py
myproject/settings.py
myproject/urls.py
myproject/wsgi.py
```

### Step (3) Update settings:

Add the following code to settings.py:

DATABASES = {
    'default': {
        # 'ENGINE': 'django.db.backends.postgresql',
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': 'django_test',
        'USER': 'seeourminds',
        'PASSWORD': 'abc123',
        'HOST': 'localhost',
        'PORT': '',
    }
}

Making additional modifications suggested by this tutorial:

* https://tutorial.djangogirls.org/en/django_start_project/

### Step (4) Make migrations:

As tomh:

```
golpy
cd 22-django_postgresql_exp/Site
python3 manage.py makemigrations
```

The output from this command is below.
Also, there is no "migrations" directory, as there is for the ../ project.

```
No changes detected
```

### Step (5) Run the server:

As tomh (in the `Site` directory):

```
python3 manage.py runserver
```

Now we get this message:

```
You have 13 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.
Run 'python manage.py migrate' to apply them.
```

### Step (6) Run the migrations:

As tomh (in the `Site/` directory):

```
python3 manage.py migrate
```

The output from this command is below.
Looks like all of the migrations ran ok.

```
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, sessions
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying sessions.0001_initial... OK
```

#### Re-run the server:

```
python3 manage.py runserver
```

Access in browser:

* http://127.0.0.1:8000/

### Step (7) Enable the admin interface:

As tomh (in the `Site/content` directory):

```
python3 manage.py createsuperuser   # django_fresh/django_fresh1
```

Output:

```
Superuser created successfully.
```

So far, so good.

### Step (8) Log in via browser

Access the following url:

* http://127.0.0.1:8000/admin

And login using the above username and password.

Everything worked fine this time!

* If there are issues, try using the 'django.db.backends.postgresql' ENGINE (instead of 'django.db.backends.postgresql_psycopg2') .

